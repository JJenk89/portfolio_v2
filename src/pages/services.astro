---
import "../styles/global.css";
import "../styles/services.css";
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

//Icon imports light
import palette from "../assets/icons/palette-white.svg";
import code from "../assets/icons/Code-white.svg";
import react from "../assets/icons/React-white.svg";
import writing from "../assets/icons/Writing-white.svg";

//Icon imports dark
import paletteDark from "../assets/icons/Palette.svg";
import codeDark from "../assets/icons/Code.svg";
import reactDark from "../assets/icons/React.svg";
import writingDark from "../assets/icons/Writing.svg";

const services = [
	{
		title: "Web Design",
		description:
			"I design clean, user-focused websites using modern tools like Figma. My work prioritises intuitive UX, elegant UI, and visual clarity while ensuring SEO best practices are built in from the start.",
		icon: palette,
		iconDark: paletteDark,
		id: 1,
	},

	{
		title: "Web Development",
		description:
			"I develop fast, accessible websites—from static pages to full brochure sites—crafted with precision and built to perform across all devices. Clean code and usability are at the heart of every project.",
		icon: code,
		iconDark: codeDark,
		id: 2,
	},

	{
		title: "Web Apps",
		description:
			"I build modern web apps, blogs, and CMS platforms using React and current best practices. My focus is on performance, scalability, and user experience that meets real-world business needs.",
		icon: react,
		iconDark: reactDark,
		id: 3,
	},

	{
		title: "Web Copywriting",
		description:
			"As a native English speaker, I write clear, concise, and engaging website copy tailored to your audience. I focus on tone, clarity, and SEO to ensure your message connects and converts.",
		icon: writing,
		iconDark: writingDark,
		id: 4,
	},
];
---

<Layout title="services">
	<section class="services">
		<Header src="/assets/icons/JJenk89.svg" />
		<h2 id="services">Services</h2>
		<p class="discover-text">
			Click on the icons to discover more about what I offer
		</p>
		<div class="cards">
			{
				services.map((service) => (
					<>
						<div class="card">
							<h3>{service.title}</h3>
							<div class="icon" id={`icon${service.id}`}>
								<img
									src={service.icon.src}
									class="dark-icon"
									alt={`${service.title} Icon`}
									height="40"
									width="40"
									loading="eager"
								/>
								<img
									src={service.iconDark.src}
									class="light-icon"
									alt={`${service.title} Icon`}
									height="40"
									width="40"
									loading="eager"
								/>
								<div class="desktop-text">
									<p
										class="desktop-description hidden"
										id={`description${service.id}`}
									>
										{service.description}
									</p>
								</div>
							</div>
							<dialog id={`dialog${service.id}`}>
								<div class="dialog-content">
									<h3>{service.title}</h3>
									<img
										src={service.icon.src}
										alt={`${service.title} Icon`}
										height="40"
										width="40"
										loading="eager"
										class="dark-icon"
									/>
									<img
										src={service.iconDark.src}
										alt={`${service.title} Icon`}
										height="40"
										width="40"
										loading="eager"
										class="light-icon"
									/>
									<p
										class="description hidden"
										id={`description${service.id}`}
									>
										{service.description}
									</p>
									<button>Close</button>
								</div>
							</dialog>
						</div>
					</>
				))
			}
		</div>
		<Footer />
	</section>
</Layout>

<script>
	const icons = document.querySelectorAll(".icon");
	const descriptions = document.querySelectorAll(".description");
	const dialogs = document.querySelectorAll("dialog");
	const closeButtons = document.querySelectorAll("dialog button");
	const width = window.innerWidth;
	const desktopDescriptions = document.querySelectorAll(
		".desktop-description"
	);

	const iconClickHandlers: (() => void)[] = [];

	function dialogOpener(index: number) {
		const dialog = dialogs[index];
		const description = descriptions[index];

		if (dialog.open) {
			dialog.close();
		} else {
			description.classList.remove("hidden");
			dialog.showModal();
		}
	}

	// Create and store the click handlers
	icons.forEach((icon, index) => {
		const clickHandler = () => {
			dialogOpener(index);
		};
		iconClickHandlers.push(clickHandler);
	});

	function addListener() {
		icons.forEach((icon, index) => {
			// Add the stored function reference
			icon.addEventListener("click", iconClickHandlers[index]);
		});
	}

	if (width > 1024) {
		desktopDescriptions.forEach((description) => {
			description.classList.remove("hidden");
		});
	} else {
		// Add listeners on mobile
		addListener();
	}

	closeButtons.forEach((button, index) => {
		button.addEventListener("click", () => {
			const dialog = dialogs[index];
			dialog.close();
		});
	});
</script>
